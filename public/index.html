<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="ì¤‘ê³ ë‚˜ë¼ì™€ ë²ˆê°œì¥í„°ë¥¼ í•œ ë²ˆì— ê²€ìƒ‰í•˜ì„¸ìš”. ì¤‘ê³  ë¬¼í’ˆì„ ì‰½ê³  ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆëŠ” í†µí•© ê²€ìƒ‰ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤." />
    <meta name="keywords" content="ì¤‘ê³ ë‚˜ë¼, ë²ˆê°œì¥í„°, ì¤‘ê³ ê±°ë˜, ì¤‘ê³ ë¬¼í’ˆ, í†µí•©ê²€ìƒ‰, ì¤‘ê³ ê²€ìƒ‰" />
    <meta name="author" content="ì¤‘ê³  ë¬¼í’ˆ í†µí•© ê²€ìƒ‰" />
    <meta property="og:title" content="ì¤‘ê³  ë¬¼í’ˆ í†µí•© ê²€ìƒ‰ - ì¤‘ê³ ë‚˜ë¼ + ë²ˆê°œì¥í„°" />
    <meta property="og:description" content="ì¤‘ê³ ë‚˜ë¼ì™€ ë²ˆê°œì¥í„°ë¥¼ í•œ ë²ˆì— ê²€ìƒ‰í•˜ëŠ” í†µí•© ê²€ìƒ‰ ì„œë¹„ìŠ¤" />
    <meta property="og:type" content="website" />
    <title>ì¤‘ê³  ë¬¼í’ˆ í†µí•© ê²€ìƒ‰ - ì¤‘ê³ ë‚˜ë¼ + ë²ˆê°œì¥í„°</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .search-container {
        text-align: center;
        margin: 20px 0;
      }
      #searchInput {
        padding: 10px;
        width: 300px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      #searchButton {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 10px;
      }
      #searchButton:hover {
        background-color: #0056b3;
      }
      .results-info {
        text-align: center;
        padding: 20px 0;
        color: #666;
        font-size: 14px;
      }
      .results-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        padding: 20px 0;
      }
      .product-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
      }
      .product-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }
      .product-card h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
      }
      .product-card h3 a {
        text-decoration: none;
        color: #333;
      }
      .product-card h3 a:hover {
        color: #007bff;
      }
      .product-card p {
        margin: 5px 0;
        color: #666;
      }
      .product-card .price {
        color: #e44d26;
        font-weight: bold;
      }
      .product-card .platform {
        color: #007bff;
        font-size: 14px;
        font-weight: bold;
      }
      .loading {
        text-align: center;
        padding: 20px;
        display: none;
        color: #666;
      }
      .loading-more {
        text-align: center;
        padding: 20px;
        color: #666;
        display: none;
      }
      .loading-more.show {
        display: block;
      }
      .end-message {
        text-align: center;
        padding: 40px;
        color: #999;
        display: none;
      }
      .end-message.show {
        display: block;
      }
      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div class="search-container">
      <h1>ì¤‘ê³  ë¬¼í’ˆ í†µí•© ê²€ìƒ‰</h1>
      <p style="color: #666; margin-top: 10px;">ì¤‘ê³ ë‚˜ë¼ + ë²ˆê°œì¥í„°ë¥¼ í•œë²ˆì— ê²€ìƒ‰í•˜ì„¸ìš”</p>
      <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë§¥ë¶, ì•„ì´íŒ¨ë“œ)" />
      <button id="searchButton">ê²€ìƒ‰</button>
    </div>
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="margin-top: 10px;">ê²€ìƒ‰ ì¤‘...</p>
    </div>
    <div class="results-info" id="resultsInfo"></div>
    <div class="results-container" id="results"></div>
    <div class="loading-more" id="loadingMore">
      <div class="spinner"></div>
      <p style="margin-top: 10px;">ë” ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
    <div class="end-message" id="endMessage">
      <p>âœ“ ëª¨ë“  ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤</p>
    </div>

    <script>
      const searchInput = document.getElementById("searchInput");
      const searchButton = document.getElementById("searchButton");
      const resultsContainer = document.getElementById("results");
      const loadingElement = document.getElementById("loading");
      const loadingMore = document.getElementById("loadingMore");
      const endMessage = document.getElementById("endMessage");
      const resultsInfo = document.getElementById("resultsInfo");

      let allProducts = [];
      let displayedCount = 0;
      const itemsPerLoad = 30; // í•œ ë²ˆì— ë¡œë“œí•  ì•„ì´í…œ ìˆ˜
      let isLoading = false;

      async function searchProducts() {
        const keyword = searchInput.value.trim();
        if (!keyword) return;

        loadingElement.style.display = "block";
        resultsContainer.innerHTML = "";
        resultsInfo.innerHTML = "";
        endMessage.classList.remove("show");
        allProducts = [];
        displayedCount = 0;

        try {
          const response = await fetch("/api/search", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ keyword }),
          });

          const data = await response.json();

          if (response.ok) {
            allProducts = data.results || [];
            displayInitialResults();
          } else {
            throw new Error(data.error || "ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          alert(error.message);
        } finally {
          loadingElement.style.display = "none";
        }
      }

      function displayInitialResults() {
        if (!allProducts || allProducts.length === 0) {
          resultsContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }

        updateResultsInfo();
        loadMoreItems();
      }

      function loadMoreItems() {
        if (isLoading || displayedCount >= allProducts.length) {
          if (displayedCount >= allProducts.length && displayedCount > 0) {
            endMessage.classList.add("show");
          }
          return;
        }

        isLoading = true;
        loadingMore.classList.add("show");

        // ì‹¤ì œ ë¡œë”© íš¨ê³¼ë¥¼ ìœ„í•œ ì•½ê°„ì˜ ë”œë ˆì´
        setTimeout(() => {
          const nextItems = allProducts.slice(displayedCount, displayedCount + itemsPerLoad);

          nextItems.forEach(product => {
            const card = createProductCard(product);
            resultsContainer.appendChild(card);
          });

          displayedCount += nextItems.length;
          updateResultsInfo();

          loadingMore.classList.remove("show");
          isLoading = false;

          // ëª¨ë“  ì•„ì´í…œì„ ë¡œë“œí–ˆìœ¼ë©´ ì¢…ë£Œ ë©”ì‹œì§€ í‘œì‹œ
          if (displayedCount >= allProducts.length) {
            endMessage.classList.add("show");
          }
        }, 300);
      }

      function createProductCard(product) {
        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <span class="platform">${product.platform || 'ë²ˆê°œì¥í„°'}</span>
          <h3><a href="${product.link}" target="_blank">${product.title}</a></h3>
          <p class="price">${product.price}</p>
          <p style="font-size: 14px; color: #999;">${product.update_time}</p>
          <p style="font-size: 14px; color: #28a745;">${product.status}</p>
          ${product.location ? `<p style="font-size: 14px; color: #666;">ğŸ“ ${product.location}</p>` : ''}
        `;
        return card;
      }

      function updateResultsInfo() {
        if (allProducts.length > 0) {
          resultsInfo.innerHTML = `ì´ ${allProducts.length}ê°œì˜ ê²€ìƒ‰ ê²°ê³¼ (${displayedCount}ê°œ í‘œì‹œ ì¤‘)`;
        }
      }

      // ë¬´í•œ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      window.addEventListener("scroll", () => {
        // í˜ì´ì§€ í•˜ë‹¨ì—ì„œ 300px ì „ì— ë„ë‹¬í•˜ë©´ ë” ë¡œë“œ
        const scrollPosition = window.innerHeight + window.scrollY;
        const threshold = document.documentElement.scrollHeight - 300;

        if (scrollPosition >= threshold && !isLoading && displayedCount < allProducts.length) {
          loadMoreItems();
        }
      });

      searchButton.addEventListener("click", searchProducts);
      searchInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") searchProducts();
      });
    </script>
  </body>
</html>
